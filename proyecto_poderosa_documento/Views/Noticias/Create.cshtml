@model proyecto_poderosa_documento.Models.Noticia
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Lista de Noticias</h2>
@using (Html.BeginForm("Create", "Noticias", FormMethod.Post, new { enctype = "multipart/form-data", id = "createForm" }))
{
    @Html.AntiForgeryToken()
    <!-- Campo para el slug -->
    <div class="form-group mb-3">
        @Html.LabelFor(model => model.Slug)
        @Html.TextBoxFor(model => model.Slug, new { @class = "form-control" })
        @Html.ValidationMessageFor(model => model.Slug, "", new { @class = "text-danger" })
    </div>

    <!-- Campo para subir imagen de compartir -->
    <div class="form-group mb-3">
        @Html.LabelFor(model => model.ImagenesCompartir, new { @class = "form-label" })
        <input type="file" name="ImagenesCompartir" class="form-control" />
    </div>

    <!-- Titulo -->
    <div class="form-group mb-3">
        @Html.LabelFor(model => model.Titulo, new { @class = "form-label" })
        @Html.TextBoxFor(model => model.Titulo, new { @class = "form-control" })
        @Html.ValidationMessageFor(model => model.Titulo, "", new { @class = "text-danger" })
    </div>

    <!--Tipo-->
    <div class="form-group mb-3">
        @Html.LabelFor(model => model.Tipo, "Tipo", htmlAttributes: new { @class = "control-label" })
        @Html.DropDownListFor(model => model.Tipo, new SelectList(new[] {
            new { Value = 1, Text = "Noticia" },
            new { Value = 2, Text = "Nota" }
        }, "Value", "Text", Model.Tipo), "Seleccione un tipo", new { @class = "form-control" })
        @Html.ValidationMessageFor(model => model.Tipo, "", new { @class = "text-danger" })
    </div>

    <!-- Campo para subir imagen -->
    <div class="form-group mb-3">
        @Html.LabelFor(model => model.Imagen, new { @class = "form-label" })
        <input type="file" name="Imagen" class="form-control" />
    </div>

    <!-- Campo para establecer fecha de la noticia -->
    <div class="form-group mb-3">
        @Html.LabelFor(model => model.FechaNoticia, "Fecha de la noticia", new { @class = "form-label" })
        @Html.TextBoxFor(model => model.FechaNoticia, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
        @Html.ValidationMessageFor(model => model.FechaNoticia, "", new { @class = "text-danger" })
    </div>

    <!-- Descripción -->
    <div class="form-group mb-3">
        @Html.LabelFor(model => model.Descripcion, new { @class = "form-label" })
        @Html.EditorFor(model => model.Descripcion, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.Descripcion, "", new { @class = "text-danger" })
    </div>

    <!-- Contenido -->
    <div class="form-group mb-3">
        @Html.LabelFor(model => model.Contenido, new { @class = "form-label" })
        @Html.TextAreaFor(model => model.Contenido, new { @class = "form-control", id = "contenido" })
        @Html.ValidationMessageFor(model => model.Contenido, "", new { @class = "text-danger" })
    </div>

    <!-- Imagen resumen -->
    <div class="form-group mb-3">
        @Html.LabelFor(model => model.ImagenResumen, new { @class = "form-label" })
        <input type="file" name="ImagenResumen" class="form-control" />
    </div>

    <!-- Campo para subir imágenes del carrusel -->
    <div class="form-group mb-3">
        @Html.Label("Imágenes del Carrusel", new { @class = "form-label" })
        <input type="file" name="ImagenesCarrusel" class="form-control" multiple />
    </div>

    <!-- Botones -->
    <div class="form-group">
        <button type="submit" class="btn btn-success" onclick="submitForm(event)">Guardar</button>
        <a href="@Url.Action("Dashboard", "Noticias")" class="btn btn-secondary">Regresar</a>
    </div>
    }

    <div class="modal fade" id="guardarModal" tabindex="-1" aria-labelledby="guardarModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="guardarModalLabel">Aviso</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>La noticia ha sido guardada exitosamente.</p>
                    <p>¿Deseas agregar otra noticia?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="addAnother()">Sí</button>
                    <button type="button" class="btn btn-primary" onclick="redirectToDashboard()">No</button>
                </div>
            </div>
        </div>
    </div>

    @section Scripts {
        <script src="~/Scripts/tinymce/tinymce.min.js" referrerpolicy="origin"></script>
        <script>
            tinymce.init({
                selector: '#contenido',
                plugins: 'advlist autolink lists link image charmap print preview hr anchor pagebreak',
                toolbar_mode: 'floating',
                content_css: '/Content/css/_fonts.css', // Ruta al archivo CSS que define las fuentes
                font_formats: 'Gotham Black=Gotham-Black; Gotham Book=Gotham-Book-Regular; Gotham Bold=Gotham-Bold;',
                toolbar: 'fontsizeselect fontselect', // Incluye el selector de fuentes en la barra de herramientas
                setup: function (editor) {
                    editor.on('init', function () {
                        editor.getBody().style.fontFamily = 'Gotham-Book-Regular'; // Fuente predeterminada
                    });
                }
            });
        </script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const form = document.querySelector("form"); // Selecciona el formulario
                const fileInputs = document.querySelectorAll("input[type='file']"); // Selecciona todos los inputs de tipo file

                form.addEventListener("submit", function (event) {
                    for (const fileInput of fileInputs) {
                        if (fileInput.files.length > 0) {
                            const fileName = fileInput.files[0].name;
                            // Validar si el nombre contiene espacios o caracteres especiales
                            const invalidChars = /[^a-zA-Z0-9._-]/;
                            if (fileName.includes(" ") || invalidChars.test(fileName)) {
                                alert("El nombre de las imagenes no pueden contener espacios ni caracteres especiales.");
                                event.preventDefault(); // Detiene el envío del formulario
                                return;
                            }
                        }
                    }
                });
            });
        </script>
    }
